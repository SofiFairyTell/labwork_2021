# Построение простого кодека

В видеопотоке выделяют 3 типа кадров: 
- I - независимо сжимаемые кадры
- P - сжатые с использованием одной ссылки на одной изображение
- B - сжатые с использованием 2-х ссылок

Для компенсации движения видео удаление межкадровой разницы работает плохо. 

Сжатие: 
- Внутрикадровое
- Межкадровое 
- Алгоритмы без потерь: сжатия : Хафмана 

Алгоритмы компенсации движения отслеживают движения объектов в кадре. 
При компенсации движения перед алгоритмами ставится 3 задачи: 
1. Уменьшение межкадровой разницы
2. Необходимость сохранения информации о движении
3. Приемлемое время работы 

Идеальный алгоритм это выделение в кадре объектов и компактное описание их движений. 

Для реализации кадр разбивается на блоки кратные 8. 

Для каждого блока в кадре находят похожий в предыдущем кадре в некоторой окрестности положения блока. Если такого блока нет, то сжимают в I-кадр. 

Для B-кадров можно выбрать наиболее близкий блок из любого кадра или интерполировать блоки из двух кадров. 

Для P-кадров ссылка производится только на предыдущий кадр. Таким образом в одной картинке может быть определенное количество I,P, B кадров. 

Классической схемой сжатия межкадровой разницы является алгоритм JPEG: блоки 8 на 8 сжимаются с помощью дискретно-косинусного преобразования. 

Алгоритм JPEG:
0. Подготовка - разбиение на блоки, далее нужно преобразовать изображение в вид яркость/цветность (схема YUV) из стандартной RGB. О яркостной составляющей информацию несет каждый канал. А вот данные о цветности можно сжимать.  
1. ДКП - преобразование массива пикселов в массив в массив значений пространственной частоты. То есть преобразование массива пикселей в функцию косинуса - а пространственная частота это сумма полученных значений косинусов. Преобразование обратимо вплоть до ошибок округления. Оно не производит сжатия. Преобразует информаию об изображении в форму, более удобную для сжатия. 
    - одномерное - представляет линейный массив из n-пикселей, каждый из которых с некоторым значением яркости. Изображение можно представить в виде суммы пространственно-частотных компонентнов с частотамтми, , изменяющимия от о до N-1
    - двумерное - стандарт для JPEG, MPEG. В этом случае матрица NxN пикселей представлена взвешенной суммой NxN косинусных функций с различными частотатами. 
2. Квантование - на этом этапе определяется матрица квантования: 
    for(i=0;i<8;i++)
    {
        for(j=0;j<8;j++)
        {
            Q[i][j] = 1+((1+i+j)*q)
        }
    }
    Где q - это коэфф. качества от него зависит степень потери качества сжатого изображения.

    Этап требует: построение матрицы квантования непосредственно в процессе сжатия изображения.
    Каждое число в матрице квантования разделить на число в соответствующей позиции в матрице полученное в результате умножения матрицы цветового фрагмента на матрицу ДКП.  
3. Вторичное сжатие

    Алгоритм. 
    1. 7bit RLE

    2. ДЯЦ c кодом переменной длины

    3. Адаптированное кодирование Хаффмана

    //В чем разница между векторной маской и растровой? Нариованное кистью - это растровая маска. 

Для повышения степени сжатия изображения используется следующее: 
1. Измение алгоритма сжатия I-кадров (DCT>>Wavelet)
2. Изменение алгоритма сжатия без потерь (Huffman >>Arithmetic)
3. Постфильтрация получающ. кадров
4. Интра-фильтрация изображения
5. Улучшение качества более значимых объектов

Битрейт - количество информации, отводимой на 1 секунду. 

DVD - 4500-9500 kbs
Mpeg4 (SD) - 300-2000 kbs
Mpeg4 - (HD) - 10000 kbs

Виды битрейта: 

- Переменный - Variable Bitrate (VBR, вариант ABR)
- Постоянный - Constant Bitrate (CBR)
- Constant Quality

Чем больше битрейт тем лучше конечный результат. 

Методика кодирования
- 1проходное 
    - (-) по качеству между сценами
    + (+) высокая скорость кодирования
- N-проходное

Контейнер то что на выходе. это формат файла. В нем может быть не только видео, но еще и звуковая дорожка. 
Кодек - то чем кодируем. 







